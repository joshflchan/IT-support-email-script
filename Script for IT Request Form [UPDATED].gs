{"files":[{"id":"1583984b-6237-4c29-bb9f-7369b14ca6c7","name":"Email Selector for Support Form","type":"server_js","source":"function onFormSubmit(e) {\n  Logger.log(\"[METHOD] onFormSubmit\");\n  \n  sendEmail(e.range);\n}\n\nfunction sendEmail(range) {\n  Logger.log(\"[METHOD] sendEmail\");\n  \n  // FETCH SPREADSHEET //\n  var values \u003d range.getValues();\n  var row \u003d values[0];\n  \n  // EXTRACT VALUES //\n  var requestCategory \u003d row[4];\n  var requestName \u003d row[2];\n  var requestRole \u003d row[3];\n  var requestEmail \u003d row[1];\n  var requestDate \u003d row[0];\n  var requestSubject \u003d row[5];\n  var requestDescription \u003d row [6];\n  var requestPrioritization \u003d row[7];\n  var requestAdditionalNotes \u003d row[8];\n  var requestAltEmail \u003d row[9];\n  var requestScreenshots \u003d row[10];\n  var requestEmailSent \u003d row[11];\n  \n  // CLEAN VARIABLES //\n  requestCategory \u003d shortenCategoryText(requestCategory);\n  \n  if (requestAdditionalNotes.length \u003d\u003d 0) \n    requestAdditionalNotes \u003d \"None\";\n  \n  var requestFollowUp \u003d \"\";\n  if (requestScreenshots.length !\u003d 0) \n    requestFollowUp \u003d requestFollowUp.concat(\"\u003cli\u003eAsk for screenshots or additional files\u003c/li\u003e\");\n  if \n    (requestAltEmail.length !\u003d 0) \n    requestFollowUp \u003d requestFollowUp.concat(\"\u003cli\u003eProvide status updates to \"+requestAltEmail+\"\u003c/li\u003e\");\n  if \n    (requestFollowUp.length \u003d\u003d 0) \n    requestFollowUp \u003d \"\u003cbr /\u003eNone\";\n  else requestFollowUp \u003d \"\u003cul\u003e\"+requestFollowUp+\"\u003c/ul\u003e\";\n  \n  // PREPARE EMAIL //\n  var emailRecipients \u003d emailCategorySelector(requestCategory);\n  var emailSubject \u003d requestSubject+\": \"+requestName+\" (\"+requestEmail+\")\";\n  var emailBody \u003d \"\u003ch3\u003eA request has been reported by \"+requestEmail+\":\u003c/h3\u003e\u003chr /\u003e \\\n      \u003cp\u003e \\\n      \u003ch5\u003eThis is an automated summary of a recent IT Support Request Ticket. This message has been sent to your email as it was selected under your category of IT specialization. If you believe that this is an error, please contact Josh on Slack or at josh.chan@cus.ca\u003c/h5\u003e\u003chr/\u003e \\\n      \u003c/p\u003e\u003cp\u003e \\\n      \u003ch1 style\u003d\u0027line-height:90%\u0027\u003e\"+requestSubject+\": \"+requestName+\"\u003cbr /\u003e \\\n      \u003cspan style\u003d\u0027font-size:60%\u0027\u003e(\"+requestDate+\")\u003c/span\u003e\u003c/h1\u003e \\\n      \u003c/p\u003e\u003chr /\u003e \\\n      \u003cp\u003e \\\n      \u003cstrong\u003eROLE:\u003c/strong\u003e\u003cbr /\u003e \\\n      \"+requestRole+\" \\\n      \u003c/p\u003e\u003cp\u003e \\\n      \u003cstrong\u003eREQUEST TYPE:\u003c/strong\u003e\u003cbr /\u003e \\\n      \"+requestCategory+\" \\\n      \u003c/p\u003e\u003cp\u003e \\\n      \u003cstrong\u003eDESCRIPTION:\u003c/strong\u003e\u003cbr /\u003e \\\n      \"+requestDescription+\" \\\n      \u003c/p\u003e\u003cp\u003e \\\n      \u003cstrong\u003ePRIORITIZATION [1 - 5]:\u003c/strong\u003e\u003cbr /\u003e \\\n      \"+requestPrioritization+\" \\\n      \u003c/p\u003e\u003cp\u003e \\\n      \u003cstrong\u003eADDITIONAL NOTES:\u003c/strong\u003e\u003cbr /\u003e \\\n      \"+requestAdditionalNotes+\" \\\n      \u003c/p\u003e\u003cp\u003e \\\n      \u003cstrong\u003eFOLLOW UP:\u003c/strong\u003e \\\n      \"+requestFollowUp+\" \\\n      \u003c/p\u003e\";\n  \n  // SEND EMAIL //\n  var confirmSheet \u003d SpreadsheetApp.getActiveSheet();\n  var confirmRange \u003d confirmSheet.getRange(confirmSheet.getLastRow(),12,1,1);\n  var EMAIL_SENT \u003d \"Email Sent!\"\n  if (requestEmailSent !\u003d EMAIL_SENT) { // Prevents sending duplicates\n    MailApp.sendEmail({\n      to: emailRecipients,\n      subject: emailSubject,\n      htmlBody: emailBody\n  });     \n    confirmRange.setValue(EMAIL_SENT);\n    confirmRange.setBackgroundRGB(0,255,0);\n    SpreadsheetApp.flush();// Make sure the cell is updated right away in case the script is interrupted\n  }\n}\n\n// HELPER FUNCTION FOR CLEAN VARIABLES //\nfunction shortenCategoryText(text) {\n  Logger.log(\"[METHOD] shortenCategoryText\");\n  \n  switch(text) {\n    case \"G Suite (Email issues, Requesting email account etc.)\":\n        return \"GSuite\";\n    case \"WordPress (Website access, WordPress issues, Website errors/issues)\":\n        return \"WordPress\";\n    case \"Domain Registration/Website Hosting\":\n        return \"Website/Server\";\n    case \"IT Consulting \u0026 Support (General help)\":\n        return \"General IT Support\";\n    default:\n        return \"IT Support\";\n  }\n}\n\n\n// HELPER FUNCTION TO SELECT CORRECT EMAIL //\nfunction emailCategorySelector(text) {\n  Logger.log(\"[METHOD] emailCategorySelector\");\n  \n  if (text \u003d\u003d \"GSuite\")\n    return \"josh.chan@cus.ca\";\n  if (text \u003d\u003d \"WordPress\")\n    return \"rachel.zhu@cus.ca\";\n  if (text \u003d\u003d \"Website/Server\")\n    return \"alvin.lo@cus.ca\";\n  if (text \u003d\u003d\"General IT Support\"|\"IT Support\")\n    return \"ansel.hartanto@cus.ca\";\n}\n\n\n// TEST FUNCTION //\n\nfunction test() {\n  Logger.log(\"[METHOD] test\");\n  \n  var ss \u003d SpreadsheetApp.openById(\"13nHs9-ShOFIosHZLNtZYlW6Avj_qHfAItZ42z218ljg\").getActiveSheet();\n  var testRange \u003d ss.getRange(8,1,1,ss.getLastColumn());\n  sendEmail(testRange);\n}"},{"id":"cb3d81d6-0bc9-48b9-90d7-ecdfcf6c6f5c","name":"appsscript","type":"json","source":"{\n  \"timeZone\": \"America/Los_Angeles\",\n  \"dependencies\": {\n  },\n  \"exceptionLogging\": \"STACKDRIVER\",\n  \"executionApi\": {\n    \"access\": \"MYSELF\"\n  }\n}"}]}